# 超级节点共建接口

[English](co-build.md) | 中文

- [简介](#简介)
    - [初始化](#初始化)
    - [配置](#配置)
    - [状态](#状态)
- [功能接口](#功能接口)
  - [认购](#认购)
  - [参选](#参选)
  - [取消](#取消)
  - [转让份额](#转让份额)
  - [接收转让](#接收转让)
  - [提取奖励](#提取奖励)
  - [退出参选](#退出参选)
  - [公投退出](#公投退出)
  - [收回押金](#收回押金)
- [查询接口](#查询接口)
  - [查询配置](#查询配置)
  - [查询共建状态](#查询共建状态)
  - [查询转让信息](#查询转让信息)
  - [查询退出详情](#查询退出详情)
  - [查询共建者集合详情](#查询共建者集合详情)
- [合约入口](#合约入口)
  - [init](#init)
  - [main](#main)
  - [query](#query)

## 简介

当用户参与 BuChain 超级节点竞选时，可以单独申请；如果资金实力不足，也可以发起节点共建计划，由众多用户共同认购共建资金，一起申请。co-build 是 BuChain 为用户发起节点共建提供的合约模板，任意用户可以使用 co-build 发起自己的超级节点共建计划，发起共建的用户称为共建**发起者**。

在共建计划中，参选超级节点所需的质押金将被划分为等额的若干份，称为**共建目标总份额**。每份所需的 BU 数，称为**共建单位**。任何用户可认购一份或多份，参与认购的用户称为**共建者**。认购额达到或超过参选超级节点所需的质押金后，发起者可以**以共建合约地址为参选地址，申请成为超级节点**。

参选成功后，超级节点可以获取 BuChain 分配的区块奖励。发起者必须将部分或全部的区块奖励，分配给共建者，分配的程度称为**区块奖励分配比率**。分给创建者们的奖励，合约将按照每个共建者认购的份额在共建总份额内的占比，分给每个创建者。如果奖励分配比率为 100%，那么发起者也被视为共建者之一，所有的区块奖励都将按认购份额占比来分配。

### 初始化
发起共建计划，必须事先约定每份共建单位的BU数、共建目标总份额和分给共建者们的区块奖励在总奖励中的比率，并以[配置](#配置)的方式写入合约代码。所以，发起者在创建共建合约的时候，必须将这些配置值以参数的形式提供给合约的初始化接口，由初始化接口以此创建共建合约。初始化接口的参数包括：
| 参数         | 描述                                           |
| :-----------| ---------------------------------------------- |
| ratio       | 区块奖励分配比率，值为百分数的分子，比如80，表示80%，必填|
| unit        | 共建单位，值为BU数，比如10000，表示每份1万BU，必填|
| shares      | 共建目标总份额，共建单位乘以目标总份额，就是共建所需的目标资金总数，必填|

### 配置

共建的发起者、共建单位、共建总份额和奖励分配比率，被统称为共建的配置，在共建合约被创建时，通过初始化参数指定，且合约一经创建不可更改。
```
    cfg = {
        'initiator'   : Chain.tx.sender, /*发起者*/
        'rewardRatio' : params.ratio,    /*区块奖励分配比率*/
        'unit'        : params.unit,     /*共建单位*/
        'raiseShares' : params.shares    /*共建目标总份额*/
    };
```

### 状态

共建的状态包括实际认购数和是否已经参选超级节点，实际认购数可以超过目标共建总份额。

```
    states = {
       'applied' : false,       /*是否已申请成为超级节点*/
       'realShares' : initShare /*实际认购份数*/
    };
```

## 功能接口

### 认购

### 参选

### 取消

### 转让份额

### 接收转让

### 提取奖励

### 退出参选

### 公投退出

### 收回押金

## 查询接口

### 查询配置

### 查询共建状态

### 查询转让信息

### 查询退出详情

### 查询共建者集合详情


